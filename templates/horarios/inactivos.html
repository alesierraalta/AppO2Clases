{% extends 'base.html' %}

{% block title %}Horarios Inactivos - Sistema de Gestión de Clases{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Horarios Inactivos</h2>
        <div>
            <a href="{{ url_for('listar_horarios') }}" class="btn btn-outline-primary me-2">
                <i class="fas fa-list me-1"></i> Ver Todos los Horarios
            </a>
            <a href="{{ url_for('nuevo_horario') }}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i> Nuevo Horario
            </a>
        </div>
    </div>

    {% if horarios %}
    <div class="card mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Filtros</h5>
            <button class="btn btn-sm btn-link d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#filtrosCollapse" aria-expanded="false" aria-controls="filtrosCollapse">
                <i class="fas fa-filter"></i> Mostrar/Ocultar
            </button>
        </div>
        <div class="card-body collapse show filter-section" id="filtrosCollapse">
            <div class="row">
                <div class="col-md-4">
                    <label for="filtroTexto" class="form-label">Buscar:</label>
                    <input type="text" id="filtroTexto" class="form-control" placeholder="Profesor o nombre de clase...">
                </div>
                <div class="col-md-4">
                    <label for="filtroDia" class="form-label">Día:</label>
                    <select id="filtroDia" class="form-select">
                        <option value="">Todos los días</option>
                        {% for dia_id, dia_nombre in dias_semana.items() %}
                        <option value="{{ dia_id }}">{{ dia_nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="filtroTipo" class="form-label">Tipo de Clase:</label>
                    <select id="filtroTipo" class="form-select">
                        <option value="">Todos los tipos</option>
                        <option value="MOVE">MOVE</option>
                        <option value="RIDE">RIDE</option>
                        <option value="BOX">BOX</option>
                        <option value="OTRO">OTRO</option>
                    </select>
                </div>
            </div>
            <div class="mt-3 text-end">
                <button id="resetFiltros" class="btn btn-outline-secondary">
                    <i class="fas fa-undo me-1"></i> Limpiar filtros
                </button>
            </div>
        </div>
    </div>

    <div class="mb-3">
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i> Esta página muestra solo los horarios inactivos. Los horarios inactivos no aparecen en la lista de asistencia ni en las clases pendientes.
        </div>
    </div>

    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="tablaHorarios">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col" class="d-none d-md-table-cell">ID</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Tipo</th>
                            <th scope="col">Día</th>
                            <th scope="col">Hora</th>
                            <th scope="col" class="d-none d-md-table-cell">Duración</th>
                            <th scope="col" class="d-none d-lg-table-cell">Capacidad</th>
                            <th scope="col" class="d-none d-md-table-cell">Profesor</th>
                            <th scope="col">Estado</th>
                            <th scope="col" class="actions-column">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for horario in horarios %}
                        <tr class="clase-{{ horario.tipo_clase|lower }} table-secondary" data-tipo="{{ horario.tipo_clase }}" data-dia="{{ horario.dia_semana }}" data-activo="0">
                            <td class="d-none d-md-table-cell">{{ horario.id }}</td>
                            <td>{{ horario.nombre }}</td>
                            <td>
                                {% if horario.tipo_clase == 'MOVE' %}
                                <span class="badge bg-move">MOVE</span>
                                {% elif horario.tipo_clase == 'RIDE' %}
                                <span class="badge bg-ride">RIDE</span>
                                {% elif horario.tipo_clase == 'BOX' %}
                                <span class="badge bg-box">BOX</span>
                                {% else %}
                                <span class="badge bg-secondary">OTRO</span>
                                {% endif %}
                            </td>
                            <td>{{ horario.nombre_dia }}</td>
                            <td>{{ horario.hora_inicio.strftime('%H:%M') }}</td>
                            <td class="d-none d-md-table-cell">{{ horario.duracion }} min</td>
                            <td class="d-none d-lg-table-cell">{{ horario.capacidad_maxima }}</td>
                            <td class="d-none d-md-table-cell">{{ horario.profesor.nombre }} {{ horario.profesor.apellido }}</td>
                            <td>
                                <span class="badge bg-secondary">Inactivo</span>
                            </td>
                            <td class="actions-column">
                                <div class="btn-group action-buttons" role="group">
                                    <a href="{{ url_for('editar_horario', id=horario.id) }}" class="btn btn-sm btn-warning">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="{{ url_for('desactivar_horario', id=horario.id) }}" class="btn btn-sm btn-success" title="Activar horario">
                                        <i class="fas fa-check-circle"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if horarios|length == 0 %}
            <div class="alert alert-info m-3" id="noResultados">
                <i class="fas fa-info-circle me-2"></i> No hay horarios inactivos.
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i> No hay horarios inactivos en el sistema.
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const filtroTexto = document.getElementById('filtroTexto');
    const filtroDia = document.getElementById('filtroDia');
    const filtroTipo = document.getElementById('filtroTipo');
    const resetFiltros = document.getElementById('resetFiltros');
    const tablaHorarios = document.getElementById('tablaHorarios');
    const noResultados = document.getElementById('noResultados');
    
    // Función para aplicar filtros
    function aplicarFiltros() {
        let textoFiltrado = filtroTexto.value.toLowerCase();
        let diaFiltrado = filtroDia.value;
        let tipoFiltrado = filtroTipo.value;
        let filasVisibles = 0;
        
        tablaHorarios.querySelectorAll('tbody tr').forEach(fila => {
            let mostrarFila = true;
            
            // Filtrar por texto
            if (textoFiltrado) {
                const contenido = fila.textContent.toLowerCase();
                if (!contenido.includes(textoFiltrado)) {
                    mostrarFila = false;
                }
            }
            
            // Filtrar por día
            if (diaFiltrado && fila.getAttribute('data-dia') !== diaFiltrado) {
                mostrarFila = false;
            }
            
            // Filtrar por tipo
            if (tipoFiltrado && fila.getAttribute('data-tipo') !== tipoFiltrado) {
                mostrarFila = false;
            }
            
            if (mostrarFila) {
                fila.style.display = '';
                filasVisibles++;
            } else {
                fila.style.display = 'none';
            }
        });
        
        // Mostrar mensaje si no hay resultados
        if (filasVisibles === 0 && noResultados) {
            noResultados.style.display = 'block';
        } else if (noResultados) {
            noResultados.style.display = 'none';
        }
    }
    
    // Eventos para aplicar filtros
    if (filtroTexto) filtroTexto.addEventListener('input', aplicarFiltros);
    if (filtroDia) filtroDia.addEventListener('change', aplicarFiltros);
    if (filtroTipo) filtroTipo.addEventListener('change', aplicarFiltros);
    
    // Evento para resetear filtros
    if (resetFiltros) {
        resetFiltros.addEventListener('click', function() {
            if (filtroTexto) filtroTexto.value = '';
            if (filtroDia) filtroDia.value = '';
            if (filtroTipo) filtroTipo.value = '';
            aplicarFiltros();
        });
    }
});
</script>
{% endblock %} 